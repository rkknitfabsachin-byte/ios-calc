<!doctype html>
<html>
<head>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta charset="utf-8">
  <title>Fabric Calculators</title>
  <style>
    :root{
      --bg:#f6f8fa;
      --card:#ffffff;
      --accent:#1976d2;
      --muted:#6b7280;
      --radius:12px;
      --maxw:760px;
      --gap:14px;
    }
    html,body{height:100%;margin:0;background:var(--bg);font-family:Inter, system-ui, -apple-system;}
    .wrap{max-width:var(--maxw);margin:18px auto;padding:14px;}
    .nav{display:flex;gap:18px;justify-content:center;padding:10px;background:white;border-radius:10px;}
    .nav a{color:var(--accent);text-decoration:none;font-weight:600;font-size:15px;}
    .nav a.active{color:#000}
    .card{background:var(--card);border-radius:var(--radius);box-shadow:0 6px 20px rgba(13,38,55,0.06);padding:18px;margin-top:18px;}
    .title{font-size:20px;text-align:center;margin:6px 0 14px}
    label{display:block;font-weight:600;color:var(--muted);margin-top:10px;font-size:13px}
    input[type=number]{width:100%;padding:12px;border-radius:8px;border:1px solid #e6e6e6;margin-top:6px;font-size:15px;}
    .btn{background:var(--accent);color:white;padding:12px 16px;border-radius:10px;border:none;font-weight:700;cursor:pointer;margin-top:14px}
    .ghost{background:white;border:1px solid #e2e8f0;padding:10px;border-radius:8px;cursor:pointer}
    .resultBox{margin-top:16px;padding:12px;border-radius:8px;background:#f9fafb;border:1px solid #eef2f7;font-weight:700;text-align:center}
    .small{font-size:13px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">

    <div class="nav card">
      <a href="#" id="link-home" class="active" onclick="showView('home');return false;">Home</a>
      <a href="#" id="link-length" onclick="showView('length');return false;">Length</a>
      <a href="#" id="link-gsm" onclick="showView('gsm');return false;">GSM</a>
      <a href="#" id="link-weight" onclick="showView('weight');return false;">Weight</a>
    </div>

    <!-- HOME -->
    <div id="view-home" class="card">
      <div class="title">Fabric Calculators</div>
      <p class="small" style="text-align:center">Select a calculator above.</p>
    </div>

    <!-- LENGTH -->
    <div id="view-length" class="card" style="display:none">
      <div class="title">Length From GSM</div>
      <label>Fabric Weight (kg)</label><input id="length-weight" type="number">
      <label>GSM</label><input id="length-gsm" type="number">
      <label>DIA (inches)</label><input id="length-dia" type="number">
      <button class="btn" onclick="calcLength()">Calculate</button>
      <button class="ghost" onclick="resetLength()">Reset</button>
      <div id="length-result" class="resultBox" style="display:none"></div>
      <button class="ghost" onclick="exportPdf('length')">Export PDF</button>
    </div>

    <!-- GSM -->
    <div id="view-gsm" class="card" style="display:none">
      <div class="title">GSM Calculator</div>
      <label>Fabric Weight (kg)</label><input id="gsm-weight" type="number">
      <label>Length (m)</label><input id="gsm-length" type="number">
      <label>DIA (inch)</label><input id="gsm-dia" type="number">
      <button class="btn" onclick="calcGsm()">Calculate</button>
      <button class="ghost" onclick="resetGsm()">Reset</button>
      <div id="gsm-result" class="resultBox" style="display:none"></div>
      <button class="ghost" onclick="exportPdf('gsm')">Export PDF</button>
    </div>

    <!-- WEIGHT -->
    <div id="view-weight" class="card" style="display:none">
      <div class="title">Weight Calculator</div>
      <label>Length (m)</label><input id="weight-length" type="number">
      <label>GSM</label><input id="weight-gsm" type="number">
      <label>DIA (inch)</label><input id="weight-dia" type="number">
      <button class="btn" onclick="calcWeight()">Calculate</button>
      <button class="ghost" onclick="resetWeight()">Reset</button>
      <div id="weight-result" class="resultBox" style="display:none"></div>
      <button class="ghost" onclick="exportPdf('weight')">Export PDF</button>
    </div>

  </div>

<script>
// ------------ Navigation ------------
function showView(name){
  ['home','length','gsm','weight'].forEach(v=>{
    document.getElementById("view-"+v).style.display = (v===name)?"block":"none";
    document.getElementById("link-"+v).classList.toggle("active", v===name);
  });
}


// ------------ FORMULAS ------------
function calcLength(){
  const w = +document.getElementById("length-weight").value;
  const gsm = +document.getElementById("length-gsm").value;
  const dia = +document.getElementById("length-dia").value;
  const out = document.getElementById("length-result");
  const length = (1000*w)/(gsm*dia*2*0.0254);
  out.innerHTML = "Length: "+length.toFixed(2)+" m";
  out.style.display="block";
  out.dataset.result = length.toFixed(2);
  out.dataset.inputs = JSON.stringify({Weight_kg:w,GSM:gsm,DIA_inch:dia});
}

function resetLength(){ location.reload(); }

function calcGsm(){
  const w = +document.getElementById("gsm-weight").value;
  const l = +document.getElementById("gsm-length").value;
  const dia = +document.getElementById("gsm-dia").value;
  const out = document.getElementById("gsm-result");
  const width = dia*2*0.0254;
  const gsm = (w*1000)/(l*width);
  out.innerHTML = "GSM: "+gsm.toFixed(2);
  out.style.display="block";
  out.dataset.result = gsm.toFixed(2);
  out.dataset.inputs = JSON.stringify({Weight_kg:w,Length_m:l,DIA_inch:dia});
}

function resetGsm(){ location.reload(); }

function calcWeight(){
  const l = +document.getElementById("weight-length").value;
  const gsm = +document.getElementById("weight-gsm").value;
  const dia = +document.getElementById("weight-dia").value;
  const out = document.getElementById("weight-result");
  const width = dia*2*0.0254;
  const weight = (l*width*gsm)/1000;
  out.innerHTML = "Weight: "+weight.toFixed(2)+" kg";
  out.style.display="block";
  out.dataset.result = weight.toFixed(2);
  out.dataset.inputs = JSON.stringify({Length_m:l,GSM:gsm,DIA_inch:dia});
}

function resetWeight(){ location.reload(); }


// ------------ PDF API CALL ------------
async function exportPdf(which){
  let outEl = document.getElementById(which+"-result");
  if (!outEl.dataset.result){ alert("Calculate first"); return; }

  const payload = {
    title: which.toUpperCase()+" Report",
    type: which,
    inputs: JSON.parse(outEl.dataset.inputs),
    result: outEl.dataset.result
  };

  // >>> REPLACE ONLY THIS LINE <<<
  const API_URL = "https://script.google.com/macros/s/AKfycbxladkXTzXx4gDGtxJZog1MQ7RrSUyjDDZGSjW-2Uk2LeciEwIwcVt2ZkCqBi4SsR3baQ/exec";

  const res = await fetch(API_URL+"?action=pdf&data="+encodeURIComponent(JSON.stringify(payload)));
  const json = await res.json();
  window.open(json.url, "_blank");
}

showView("home");
</script>
</body>
</html>
